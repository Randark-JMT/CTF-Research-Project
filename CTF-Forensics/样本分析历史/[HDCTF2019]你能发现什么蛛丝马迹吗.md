# [HDCTF2019]你能发现什么蛛丝马迹吗

> 样本来源：BUUCTF
> 
> 所属组织：HDCTF
> 
> 样本平台：Win2003SP1x86
> 
> 文件名：memory.img
> 
> MD5：A8CC498029CA4797AA617F8D86AEEE78

就是比赛原题，应该是比较简单的。

首先，看一下映像信息：

```shell
┌──(kali㉿kali)-[~/volatility]
└─$ python vol.py -f /home/kali/memory.img imageinfo
Volatility Foundation Volatility Framework 2.6.1
INFO    : volatility.debug    : Determining profile based on KDBG search...
          Suggested Profile(s) : Win2003SP0x86, Win2003SP1x86, Win2003SP2x86
                     AS Layer1 : IA32PagedMemoryPae (Kernel AS)
                     AS Layer2 : FileAddressSpace (/home/kali/memory.img)
                      PAE type : PAE
                           DTB : 0xe02000L
                          KDBG : 0x8088e3e0L
          Number of Processors : 1
     Image Type (Service Pack) : 1
                KPCR for CPU 0 : 0xffdff000L
             KUSER_SHARED_DATA : 0xffdf0000L
           Image date and time : 2019-04-25 08:43:06 UTC+0000
     Image local date and time : 2019-04-25 16:43:06 +0800
```

经过验证，这个镜像实际上是Win2003SP1x86，那简单看一下进程列表：

```shell
┌──(kali㉿kali)-[~/volatility]
└─$ python vol.py -f /home/kali/memory.img --profile=Win2003SP1x86 pslist
Volatility Foundation Volatility Framework 2.6.1
Offset(V)  Name                    PID   PPID   Thds     Hnds   Sess  Wow64 Start                          Exit                          
---------- -------------------- ------ ------ ------ -------- ------ ------ ------------------------------ ------------------------------
0x81f8f020 System                    4      0     56      319 ------      0                                                              
0xfe2f8448 smss.exe                380      4      3       18 ------      0 2018-12-07 16:20:54 UTC+0000                                 
0xfe2caa60 csrss.exe               516    380     12      509      0      0 2018-12-07 16:21:00 UTC+0000                                 
0xfe304298 winlogon.exe            580    380     25      504      0      0 2018-12-07 16:21:04 UTC+0000                                 
0xfe2fdd88 services.exe            648    580     16      303      0      0 2018-12-07 16:21:05 UTC+0000                                 
0xfe2e5530 lsass.exe               660    580     38      458      0      0 2018-12-07 16:21:05 UTC+0000                                 
0xfe2f9290 vmacthlp.exe            880    648      1       26      0      0 2018-12-07 16:21:06 UTC+0000                                 
0xfe34d658 svchost.exe             932    648      6       93      0      0 2018-12-07 16:21:07 UTC+0000                                 
0xfde05020 svchost.exe             984    648     10      268      0      0 2018-12-07 16:21:07 UTC+0000                                 
0xfddf4c08 svchost.exe            1040    648     10      138      0      0 2018-12-07 16:21:08 UTC+0000                                 
0xfddeb020 svchost.exe            1072    648     15      168      0      0 2018-12-07 16:21:08 UTC+0000                                 
0xfdde9a70 svchost.exe            1096    648     79     1271      0      0 2018-12-07 16:21:08 UTC+0000                                 
0x81e5a7d0 spoolsv.exe            1668    648     14      151      0      0 2018-12-07 16:21:26 UTC+0000                                 
0xfe7385e8 msdtc.exe              1700    648     16      166      0      0 2018-12-07 16:21:26 UTC+0000                                 
0xfddb7b18 svchost.exe            1800    648      2       54      0      0 2018-12-07 16:21:27 UTC+0000                                 
0xfddb1020 svchost.exe            1848    648      2       37      0      0 2018-12-07 16:21:27 UTC+0000                                 
0xfdda8020 VGAuthService.e        1920    648      2       65      0      0 2018-12-07 16:21:28 UTC+0000                                 
0xfdc6eb18 vmtoolsd.exe            300    648      8      244      0      0 2018-12-07 16:21:36 UTC+0000                                 
0xfe3d5600 svchost.exe             484    648     16      135      0      0 2018-12-07 16:21:40 UTC+0000                                 
0xfe3d4cb0 dllhost.exe             736    648     22      239      0      0 2018-12-07 16:21:41 UTC+0000                                 
0xfe30ed88 dllhost.exe            1052    648     22      236      0      0 2018-12-07 16:21:42 UTC+0000                                 
0xfdc40638 wmiprvse.exe           1368    932      9      215      0      0 2018-12-07 16:21:44 UTC+0000                                 
0xfdc1bb18 explorer.exe           1992   1664     16      386      0      0 2018-12-07 16:21:50 UTC+0000                                 
0xfdc1ad88 vssvc.exe              2040    648      7      112      0      0 2018-12-07 16:21:51 UTC+0000                                 
0xfdbd3418 vmtoolsd.exe           1596   1992      6      166      0      0 2018-12-07 16:22:01 UTC+0000                                 
0xfdbd2110 ctfmon.exe             1840   1992      1       69      0      0 2018-12-07 16:22:01 UTC+0000                                 
0xfdbbc330 conime.exe             1792   1636      1       32      0      0 2018-12-07 16:22:16 UTC+0000                                 
0xfdba5320 wmiprvse.exe           1128    932      8      165      0      0 2018-12-07 16:22:24 UTC+0000                                 
0xfdb90930 wuauclt.exe            2224   1096      5      116      0      0 2018-12-07 16:22:44 UTC+0000                                 
0xfdb6a638 DumpIt.exe             3660   1992      1       26      0      0 2019-04-25 08:43:04 UTC+0000     
```

那先看一下DumpIt.exe的数据：

```shell
┌──(kali㉿kali)-[~/volatility]
└─$ python vol.py -f /home/kali/memory.img --profile=Win2003SP1x86 memdump -p 3660 -D /home/kali
Volatility Foundation Volatility Framework 2.6.1
************************************************************************
Writing DumpIt.exe [  3660] to 3660.dmp

┌──(kali㉿kali)-[~/volatility]
└─$ foremost /home/kali/3660.dmp 
Processing: /home/kali/3660.dmp
|*|
```

```shell
Foremost version 1.5.7 by Jesse Kornblum, Kris Kendall, and Nick Mikus
Audit File

Foremost started at Wed Dec 29 22:22:19 2021
Invocation: foremost 1992.dmp 
Output directory: /home/kali/output
Configuration file: /etc/foremost.conf
------------------------------------------------------------------
File: 1992.dmp
Start: Wed Dec 29 22:22:19 2021
Length: 75 MB (79413248 bytes)

Num     Name (bs=512)           Size     File Offset     Comment 

0:    00001834.gif           345 B          939088       (18759 x 14406)
1:    00001870.gif            85 B          957900       (18759 x 14406)
2:    00008054.gif           199 B         4123722       (18759 x 14406)
3:    00010179.gif           867 B         5212064       (18759 x 14406)
4:    00010217.gif            4 KB         5231360       (0 x 18759)
5:    00013229.gif            51 B         6773740       (3 x 3)
6:    00013230.gif            50 B         6773792       (3 x 3)
7:    00013230_1.gif           234 B         6773844       (25 x 33)
8:    00013230_2.gif            5 KB         6774080       (94 x 17)
9:    00012561.avi           11 KB         6431540      
10:    00014351.avi           11 KB         7347736      
11:    00015997.avi            6 KB         8190944      
12:    00016579.avi           12 KB         8488912      
13:    00018865.avi           10 KB         9659212      
14:    00135457.avi           10 KB        69354316      
15:    00007938.zip           696 B         4064506      
16:    00004184.exe          971 KB         2142208      03/25/2005 00:41:10
17:    00009488.dll          310 KB         4857856      04/04/2005 20:46:30
18:    00010120.dll            1 MB         5181440      04/04/2005 20:44:43
19:    00013568.dll          262 KB         6946816      04/04/2005 20:45:53
20:    00014512.dll           14 KB         7430144      04/04/2005 20:46:12
21:    00014544.dll           23 KB         7446528      03/26/2003 03:45:22
22:    00015232.dll          528 KB         7798784      03/26/2003 03:45:21
23:    00016304.dll           34 KB         8347648      04/04/2005 20:45:44
24:    00016440.dll            1 MB         8417280      03/26/2003 03:45:14
25:    00019392.dll          273 KB         9928704      04/04/2005 20:44:59
26:    00020112.dll            1 MB        10297344      04/04/2005 20:44:44
27:    00022216.dll           54 KB        11374592      04/04/2005 20:45:34
28:    00022528.dll            1 MB        11534336      04/04/2005 20:45:35
29:    00027008.exe            6 KB        13828096      03/25/2003 07:13:00
30:    00027080.exe           71 KB        13864960      03/25/2005 00:34:14
31:    00027248.exe            7 KB        13950976      03/25/2005 00:28:48
32:    00033904.exe            2 MB        17358848      03/25/2005 00:28:04
33:    00047936.dll            1 MB        24543232      11/18/2014 03:14:35
34:    00105824.exe           45 KB        54181888      02/14/2011 23:10:51
35:    00107256.exe           59 KB        54915072      03/25/2005 00:40:23
36:    00108752.dll          273 KB        55681024      04/04/2005 20:44:58
37:    00109456.dll          246 KB        56041472      04/04/2005 20:48:00
38:    00110464.exe          352 KB        56557568      03/25/2005 00:40:19
39:    00112336.exe           10 KB        57516032      02/20/2014 00:09:11
40:    00114104.exe           48 KB        58421248      12/13/2004 21:03:14
41:    00114608.exe            6 KB        58679296      03/25/2003 07:13:00
42:    00114680.exe           71 KB        58716160      03/25/2005 00:34:14
43:    00114848.exe            7 KB        58802176      03/25/2005 00:28:48
44:    00114944.exe           64 KB        58851328      03/25/2005 00:40:55
45:    00115080.exe          428 KB        58920960      03/25/2005 00:41:13
46:    00116072.exe          152 KB        59428864      06/22/2015 23:27:14
47:    00116792.exe          176 KB        59797504      03/25/2005 00:40:31
48:    00117776.exe           80 KB        60301312      03/25/2005 00:40:49
49:    00118560.exe           58 KB        60702720      03/25/2005 00:30:46
50:    00124576.exe          231 KB        63782912      03/25/2005 00:40:27
51:    00125088.exe           18 KB        64045056      03/25/2005 00:28:56
52:    00125168.exe           61 KB        64086016      03/25/2005 00:40:43
53:    00125296.exe           91 KB        64151552      03/25/2005 00:40:46
54:    00125616.dll           60 KB        64315392      03/25/2005 00:30:34
55:    00125880.exe           92 KB        64450560      01/13/2003 19:12:12
56:    00126344.exe           88 KB        64688128      03/25/2005 00:29:53
57:    00126584.exe           57 KB        64811008      03/25/2005 00:28:46
58:    00126720.exe           59 KB        64880640      03/25/2005 00:28:29
59:    00127688.dll          233 KB        65376256      04/04/2005 20:44:59
60:    00128184.exe          181 KB        65630208      03/25/2005 00:40:26
61:    00129192.dll          132 KB        66146304      03/25/2005 00:28:53
62:    00129608.exe           53 KB        66359296      03/25/2005 00:40:23
63:    00129800.exe           48 KB        66457600      12/13/2004 21:03:14
64:    00129912.exe           93 KB        66514944      03/25/2005 00:28:49
65:    00130120.exe          145 KB        66621440      03/25/2005 00:30:02
66:    00130424.exe          132 KB        66777088      03/25/2005 00:29:00
67:    00130832.exe            6 KB        66985984      03/25/2003 07:13:00
68:    00130864.exe           36 KB        67002368      03/25/2003 07:16:35
69:    00130952.exe           45 KB        67047424      03/25/2005 00:27:23
70:    00131072.exe           63 KB        67108864      05/18/2013 01:17:35
71:    00131288.exe           39 KB        67219456      03/25/2005 00:28:58
72:    00131416.exe           43 KB        67284992      03/25/2005 00:34:11
73:    00131512.exe           14 KB        67334144      03/25/2005 00:33:16
74:    00131560.exe           22 KB        67358720      03/25/2003 07:03:10
75:    00131640.exe           17 KB        67399680      03/25/2005 00:28:27
76:    00131760.exe            9 KB        67461120      03/25/2005 00:30:19
77:    00131816.exe           38 KB        67489792      03/25/2005 00:28:40
78:    00131904.exe           40 KB        67534848      03/25/2005 00:34:16
79:    00132000.exe           20 KB        67584000      03/25/2005 00:35:34
80:    00132080.exe           20 KB        67624960      03/25/2005 00:28:25
81:    00132136.exe           19 KB        67653632      03/25/2005 00:34:16
82:    00132184.dll           40 KB        67678208      03/25/2005 00:27:15
83:    00132304.exe           39 KB        67739648      03/25/2005 00:34:13
84:    00132424.exe           23 KB        67801088      03/25/2005 00:29:54
85:    00132536.exe           38 KB        67858432      03/25/2005 00:33:31
86:    00132624.exe           14 KB        67903488      03/25/2005 00:34:37
87:    00132656.exe           35 KB        67919872      03/25/2005 00:34:07
88:    00132728.exe           34 KB        67956736      03/25/2005 00:33:21
89:    00132968.exe           11 KB        68079616      03/25/2003 07:10:17
90:    00133008.dll           35 KB        68100096      03/25/2003 07:10:17
91:    00133096.dll            8 KB        68145152      03/25/2003 07:08:00
92:    00133120.dll           13 KB        68157440      03/25/2003 07:07:58
93:    00133152.exe           16 KB        68173824      03/25/2005 00:34:07
94:    00133208.exe           20 KB        68202496      03/25/2005 00:30:45
95:    00133280.exe           26 KB        68239360      03/25/2005 00:30:43
96:    00133368.exe            5 KB        68284416      03/25/2003 07:09:12
97:    00133400.exe            6 KB        68300800      03/25/2003 07:03:04
98:    00133432.exe            6 KB        68317184      03/25/2003 07:07:53
99:    00133456.exe            6 KB        68329472      03/25/2003 07:03:05
100:    00133480.exe           10 KB        68341760      03/25/2003 07:11:50
101:    00133520.exe           31 KB        68362240      03/25/2005 00:30:48
102:    00133600.exe           12 KB        68403200      03/25/2003 07:03:12
103:    00133632.exe            5 KB        68419584      03/25/2003 07:05:52
104:    00133680.exe           10 KB        68444160      03/25/2003 07:16:28
105:    00134608.exe           59 KB        68919296      03/25/2005 00:28:29
106:    00134736.exe           13 KB        68984832      03/25/2003 07:16:28
107:    00134808.exe          107 KB        69021696      03/25/2005 00:40:23
108:    00136880.exe          575 KB        70082560      03/25/2005 00:40:29
109:    00146304.dll          950 KB        74907648      04/04/2005 20:45:48
110:    00001846.png            6 KB          945336       (256 x 256)
111:    00001858.png            3 KB          951681       (322 x 96)
112:    00008058.png            6 KB         4125864       (256 x 256)
113:    00008070.png            3 KB         4132209       (322 x 96)
Finish: Wed Dec 29 22:22:20 2021

114 FILES EXTRACTED

gif:= 9
rif:= 6
zip:= 1
exe:= 94
png:= 4
------------------------------------------------------------------

Foremost finished at Wed Dec 29 22:22:20 2021
```

在输出中，可以看到有四个文件：

```shell
00001846.png
00001858.png
00008058.png
00008070.png
```

将数据提取出来：

```textile
key: Th1s_1s_K3y00000
iv: 1234567890123456
jfXvUoypb8p3zvmPks8kJ5Kt0vmEw0xUZyRGOicraY4=
```

那么直接AES解密，得到：

```textile

```
